base_prep_time = 0.000237
base_parse_time = 0.849082
base_generation_time = 0.003051
base_exec_time = 0.038902
base_generated_sql = """

WITH 
cheerful as (
SELECT
    cast(returns_return_date_date.\"D_YEAR\" as int) as \"returns_return_date_year\",
    returns_customer_customers.\"C_CUSTOMER_ID\" as \"returns_customer_text_id\",
    returns_store_returns.\"SR_ITEM_SK\" as \"returns_item_id\",
    returns_store_returns.\"SR_RETURN_AMT\" as \"returns_return_amount\",
    returns_store_returns.\"SR_TICKET_NUMBER\" as \"returns_store_sales_ticket_number\",
    returns_store_store.\"S_STATE\" as \"returns_store_state\",
    returns_store_store.\"S_STORE_SK\" as \"returns_store_id\"
FROM
    memory.store_returns as returns_store_returns
    INNER JOIN memory.date_dim as returns_return_date_date on returns_store_returns.\"SR_RETURNED_DATE_SK\" = returns_return_date_date.\"D_DATE_SK\"
    INNER JOIN memory.store as returns_store_store on returns_store_returns.\"SR_STORE_SK\" = returns_store_store.\"S_STORE_SK\"
    INNER JOIN memory.customer as returns_customer_customers on returns_store_returns.\"SR_CUSTOMER_SK\" = returns_customer_customers.\"C_CUSTOMER_SK\"
WHERE
    returns_store_store.\"S_STATE\" = 'TN' and cast(returns_return_date_date.\"D_YEAR\" as int) = 2000
),
thoughtful as (
SELECT
    cheerful.\"returns_customer_text_id\" as \"returns_customer_text_id\",
    cheerful.\"returns_store_id\" as \"returns_store_id\",
    sum(cheerful.\"returns_return_amount\") as \"total_returns\"
FROM
    cheerful
GROUP BY 
    cheerful.\"returns_customer_text_id\",
    cheerful.\"returns_store_id\"),
cooperative as (
SELECT
    avg(thoughtful.\"total_returns\") as \"avg_store_returns\",
    thoughtful.\"returns_store_id\" as \"returns_store_id\"
FROM
    thoughtful
GROUP BY 
    thoughtful.\"returns_store_id\")
SELECT
    thoughtful.\"returns_customer_text_id\" as \"returns_customer_text_id\"
FROM
    cooperative
    INNER JOIN thoughtful on cooperative.\"returns_store_id\" = thoughtful.\"returns_store_id\"
WHERE
    thoughtful.\"total_returns\" > ( 1.2 * cooperative.\"avg_store_returns\" )

ORDER BY 
    thoughtful.\"returns_customer_text_id\" asc
LIMIT (100)"""
optimized_prep_time = 1.702529
optimized_parse_time = 1.368819
optimized_generation_time = 0.001053
optimized_exec_time = 0.016414
optimized_generated_sql = """

WITH 
macho as (
SELECT
    default_id_id_text_id_ticket_number_year_89f0b8d713089ca2e55d9cd2b6b95850e1993d319eeffff7af06fb57ab6fa8bd_filtered_on_state_year.\"returns_customer_text_id\" as \"returns_customer_text_id\",
    default_id_id_text_id_ticket_number_year_89f0b8d713089ca2e55d9cd2b6b95850e1993d319eeffff7af06fb57ab6fa8bd_filtered_on_state_year.\"returns_store_id\" as \"returns_store_id\",
    sum(default_id_id_text_id_ticket_number_year_89f0b8d713089ca2e55d9cd2b6b95850e1993d319eeffff7af06fb57ab6fa8bd_filtered_on_state_year.\"returns_return_amount\") as \"total_returns\"
FROM
    id_id_text_id_ticket_number_year_89f0b8d713089ca2e55d9cd2b6b95850e1993d319eeffff7af06fb57ab6fa8bd_filtered_on_state_year as default_id_id_text_id_ticket_number_year_89f0b8d713089ca2e55d9cd2b6b95850e1993d319eeffff7af06fb57ab6fa8bd_filtered_on_state_year
GROUP BY 
    default_id_id_text_id_ticket_number_year_89f0b8d713089ca2e55d9cd2b6b95850e1993d319eeffff7af06fb57ab6fa8bd_filtered_on_state_year.\"returns_customer_text_id\",
    default_id_id_text_id_ticket_number_year_89f0b8d713089ca2e55d9cd2b6b95850e1993d319eeffff7af06fb57ab6fa8bd_filtered_on_state_year.\"returns_store_id\"),
scrawny as (
SELECT
    avg(macho.\"total_returns\") as \"avg_store_returns\",
    macho.\"returns_store_id\" as \"returns_store_id\"
FROM
    macho
GROUP BY 
    macho.\"returns_store_id\")
SELECT
    macho.\"returns_customer_text_id\" as \"returns_customer_text_id\"
FROM
    scrawny
    INNER JOIN macho on scrawny.\"returns_store_id\" = macho.\"returns_store_id\"
WHERE
    macho.\"total_returns\" > ( 1.2 * scrawny.\"avg_store_returns\" )

ORDER BY 
    macho.\"returns_customer_text_id\" asc
LIMIT (100)"""
query_id = 1
sql_comp_time = 0.081304
total_time = 4.06989
