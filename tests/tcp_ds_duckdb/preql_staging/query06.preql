# Generated from preql source: c:\Users\ethan\coding_projects\pypreql-etl\tests\tcp_ds_duckdb\query06.preql
# Do not edit manually
# import shared CTE persists into local namespace 
import _internal_cached_intermediates_7c6dbeeb44250a67208d8ab43bf4695b85c0cd0a317ce369e3625dd1c2d5f6f6;

import store_sales as store_sales;

import item as item;

MERGE store_sales.item.id into item.id;

SELECT
    store_sales.customer.state,
    count(store_sales.customer.id) -> customer_count,
WHERE
    store_sales.date.year = 2001 and (store_sales.date.month_of_year = 1 and (store_sales.item.current_price > multiply(1.2,avg(item.current_price) by item.category) and item.category is not null))
ORDER BY
    customer_count asc nulls first,

    store_sales.customer.state asc nulls first
;