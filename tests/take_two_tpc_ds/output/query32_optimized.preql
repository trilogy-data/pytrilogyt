import _trilogyt_opt_6deac362b912a522e988d667a804c4abc1eebc1067d7b2c84f997c905f09fd9c;

const start_date <- '2000-01-27'::date;

const end_date <- '2000-04-26'::date; # Transform this tpc-ds sql query to trilogy following trilogy syntax

metric avg_item_disc <- 1.3 * avg(filter discount_amount where sold_date.date >= start_date and sold_date.date <= end_date) by item.id;

WHERE
    item.manufacturer_id = 977 and ((sold_date.date >= start_date and sold_date.date <= end_date) and discount_amount > avg_item_disc)
SELECT
    sum(discount_amount) -> total_discount,
LIMIT 100
;