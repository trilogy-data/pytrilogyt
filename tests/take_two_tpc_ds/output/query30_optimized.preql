import _trilogyt_opt_6ab310af0a7893b1e13992e5803fcb0c049b8b69ad076ad3d38fd301a97dbef2;

metric customer_state_returns_2002 <- sum(filter web_returns.return_amount where web_returns.return_date.year = 2002) by web_returns.return_address.state, web_returns.customer.id;

metric scaled_state_returns_2002 <- 1.2 * avg(customer_state_returns_2002) by web_returns.return_address.state;

WHERE
    customer_state_returns_2002 > scaled_state_returns_2002 and (web_returns.customer.state = 'GA' and web_returns.return_address.state is not null)
SELECT
    --web_returns.customer.id,
    web_returns.customer.text_id,
    web_returns.customer.salutation,
    web_returns.customer.first_name,
    web_returns.customer.last_name,
    web_returns.customer.preferred_cust_flag,
    web_returns.customer.birth_day,
    web_returns.customer.birth_month,
    web_returns.customer.birth_year,
    web_returns.customer.birth_country,
    web_returns.customer.login,
    web_returns.customer.email_address,
    web_returns.customer.last_review_date,
    customer_state_returns_2002,
ORDER BY
    web_returns.customer.text_id asc nulls first,
    web_returns.customer.salutation asc nulls first,
    web_returns.customer.first_name asc nulls first,
    web_returns.customer.last_name asc nulls first,
    web_returns.customer.preferred_cust_flag asc nulls first,
    web_returns.customer.birth_day asc nulls first,
    web_returns.customer.birth_month asc nulls first,
    web_returns.customer.birth_year asc nulls first,
    web_returns.customer.birth_country asc nulls first,
    web_returns.customer.login asc nulls first,
    web_returns.customer.email_address asc nulls first,
    web_returns.customer.last_review_date asc nulls first,
    customer_state_returns_2002 asc nulls first
LIMIT 100
;