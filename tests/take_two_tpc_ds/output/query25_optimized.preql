import _trilogyt_opt_c822c3e569302d295359aca08421c08b7e000eef8e1ee838043b54da140f0301;

MERGE catalog_sales.bill_customer.id into store_sales.customer.id;

MERGE catalog_sales.item.id into store_sales.item.id;

WHERE
    store_sales.date.year = 2001 and (store_sales.date.month_of_year = 4 and (store_sales.return_date.year = 2001 and ((store_sales.return_date.month_of_year >= 4 and store_sales.return_date.month_of_year <= 10) and (catalog_sales.date.year = 2001 and ((catalog_sales.date.month_of_year >= 4 and catalog_sales.date.month_of_year <= 10) and (store_sales.return_customer.id = store_sales.customer.id and store_sales.is_returned))))))
SELECT
    store_sales.item.name,
    store_sales.item.desc,
    store_sales.store.text_id,
    store_sales.store.name,
    sum(store_sales.net_profit) -> store_sales_profit,
    sum(store_sales.return_net_loss) -> store_returns_loss,
    sum(catalog_sales.net_profit) -> catalog_sales_profit,
ORDER BY
    store_sales.item.name asc,
    store_sales.item.desc asc,
    store_sales.store.text_id asc,
    store_sales.store.name asc
LIMIT 100
;